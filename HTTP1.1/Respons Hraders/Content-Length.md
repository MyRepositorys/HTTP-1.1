# Content-Length



> ### 为什么需要Content-Length



首先要明确的是<code>HTTP/1.1</code> 协议默认的是持久连接，也就是说会基于一次<code>TCP/IP</code> 的连接会有多个<code>HTTP </code> 请求，响应的传输，



* 但是这里存在一个问题，当服务器发送数据给给客户端的时候，客户端怎么知道本次响应发送了多少数据，客户端获取了本次响应的所有数据，

* 客户端什么时候可以发起下一个请求？



#### 这就是响应头中存在<code>Content-Length</code>  的原因

  

在服务器接收到客户端资源的请求后，会准备响应数据，根据客户端可以接受的字符编码方式，对响应正文进行编码，然后将响应正文中数据的大小，计算出来，然后放在响应头中，

当客户端收到响应后读取<code>Content-Length</code> 后，会根据该值读取对应字节数量的响应正文，然后根据响应头中响应的字符编码方式解码，处理，显示，然后才会发起下一个资源请求，



##### 但是并不不是所有的响应中都会有该响应头的

当客户端请求一个资源后，服务器发现，该资源需要动态的生成，那么服务器就无法一次性的计算出该响应的字节大小，所以服务器会采取分块传输的方式

所谓的分块传输，就是先发送响应头给客户端，在该响应头中标注，本次响应的响应正文的传输方式是分块传输

，客户端在接收到响应头并解析后就知道了响应正文的传输方式了，然后准备读取分块数据

服务器在发送响应头后，会发送分块数据，每个分块数据的最前面有一个字节的16进制数，表示当前分块的数据大小，

然后在最后的分块中发送	0 CRLF, 当客户端检测到该数据后就知道分块数据传输完了，

当然也有可能存在拖挂，如果有拖挂，在接收到响应头之后就知道了

分块传输的响应头之中是没有<code>Content-Length</code> 字段的





##### 分块传输的样子



<img src='../image/chunke.png'>

